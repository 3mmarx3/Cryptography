<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Hill Cipher</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../style/style.css" />
    <link rel="stylesheet" href="../style/main.css" />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
  </head>

  <body>
    <main class="main-content-wrapper">
 
      <header id="header"></header>

      <div class="card">
        <h1>Hill Cipher Fully Dynamic</h1>

        <label>Matrix Size (N × N)</label>
        <input
          id="matrixSize"
          type="number"
          min="2"
          max="5"
          value="2"
          onchange="generateMatrix()"
        />

        <div class="matrix-container" id="matrix"></div>

        <label>Message</label>
        <textarea id="message" placeholder="Example: HELLO"></textarea>

        <button onclick="encrypt()">Encrypt</button>
        <div class="box" id="encrypted"></div>

        <button onclick="decrypt()">Decrypt</button>
        <div class="box" id="decrypted"></div>

        <div class="footer">Educational Hill Cipher – Fully Dynamic</div>
      </div>
    </main>
  <script src="../app/header.js"></script>
    <script>
      function mod(n, m) {
        return ((n % m) + m) % m;
      }

      function matrixDeterminant(m) {
        let n = m.length;
        if (n === 1) return m[0][0];
        if (n === 2) return m[0][0] * m[1][1] - m[0][1] * m[1][0];
        let d = 0;
        for (let j = 0; j < n; j++) {
          let s = [];
          for (let r = 1; r < n; r++) {
            let row = [];
            for (let c = 0; c < n; c++) if (c !== j) row.push(m[r][c]);
            s.push(row);
          }
          d += (j % 2 === 0 ? 1 : -1) * m[0][j] * matrixDeterminant(s);
        }
        return d;
      }

      function modInverse(a, m) {
        a = mod(a, m);
        for (let x = 1; x < m; x++) if (mod(a * x, m) === 1) return x;
        return null;
      }

      function getAdjoint(m) {
        let n = m.length,
          adj = [];
        for (let i = 0; i < n; i++) {
          adj[i] = [];
          for (let j = 0; j < n; j++) {
            let s = [];
            for (let r = 0; r < n; r++)
              if (r !== i) {
                let row = [];
                for (let c = 0; c < n; c++) if (c !== j) row.push(m[r][c]);
                s.push(row);
              }
            adj[i][j] = mod(
              ((i + j) % 2 === 0 ? 1 : -1) * matrixDeterminant(s),
              26
            );
          }
        }
        return adj[0].map((_, i) => adj.map((r) => r[i]));
      }

      function getInverseMatrix(m) {
        let d = matrixDeterminant(m);
        let invD = modInverse(d, 26);
        if (invD === null) return null;
        let adj = getAdjoint(m);
        return adj.map((r) => r.map((v) => mod(v * invD, 26)));
      }

      function generateMatrix() {
        let size = parseInt(matrixSize.value);
        matrix.innerHTML = "";
        matrix.style.gridTemplateColumns = `repeat(${size},1fr)`;
        let sample = size === 2 ? [3, 3, 2, 5] : [];
        for (let i = 0; i < size * size; i++) {
          let input = document.createElement("input");
          input.type = "number";
          input.placeholder = sample[i] ?? `k${i + 1}`;
          if (sample[i] !== undefined) input.value = sample[i];
          matrix.appendChild(input);
        }
      }

      function getMatrix() {
        let size = parseInt(matrixSize.value);
        let inputs = [...matrix.querySelectorAll("input")];
        if (inputs.some((i) => i.value === "")) return null;
        let m = [];
        for (let i = 0; i < size; i++) {
          let r = [];
          for (let j = 0; j < size; j++)
            r.push(parseInt(inputs[i * size + j].value));
          m.push(r);
        }
        return m;
      }

      function textToNums(t, s) {
        t = t.toUpperCase().replace(/[^A-Z]/g, "");
        while (t.length % s !== 0) t += "X";
        let v = [];
        for (let i = 0; i < t.length; i += s) {
          let r = [];
          for (let j = 0; j < s; j++) r.push(t.charCodeAt(i + j) - 65);
          v.push(r);
        }
        return v;
      }

      function numsToText(v) {
        return v
          .map((r) => r.map((c) => String.fromCharCode(c + 65)).join(""))
          .join("");
      }

      function multiply(m, v) {
        return m.map((r) =>
          mod(
            r.reduce((a, c, i) => a + c * v[i], 0),
            26
          )
        );
      }

      function encrypt() {
        let m = getMatrix();
        if (!m) return alert("Fill matrix values");
        if (modInverse(matrixDeterminant(m), 26) === null)
          return alert("Matrix not invertible");
        let msg = message.value.trim();
        if (!msg) return alert("Enter message");
        let s = m.length;
        let v = textToNums(msg, s);
        encrypted.textContent = numsToText(v.map((x) => multiply(m, x)));
        decrypted.textContent = "";
      }

      function decrypt() {
        let m = getMatrix();
        if (!m) return alert("Fill matrix values");
        let inv = getInverseMatrix(m);
        if (!inv) return alert("Matrix not invertible");
        let txt = encrypted.textContent.trim();
        if (!txt) return alert("Encrypt first");
        let s = m.length;
        let v = textToNums(txt, s);
        decrypted.textContent = numsToText(v.map((x) => multiply(inv, x)));
      }

      generateMatrix();
    </script>
  </body>
</html>
