<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>RSA Manual Encryption</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../style/style.css" />
    <link rel="stylesheet" href="../style/main.css" />
    <link rel="stylesheet" href="./assets/style/main.css" />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
  </head>

  <body>
    <main class="main-content-wrapper">
 
      <header id="header"></header>
      <div class="card">
        <h1>RSA Manual Encryption</h1>
        <div class="subtitle">Enter Your Own Public & Private Keys</div>
        <div class="row">
          <div>
            <label for="pubE">Public Key (e)</label>
            <input id="pubE" placeholder="Example: 17" value="17" />
          </div>
          <div>
            <label for="modN">Modulus (n)</label>
            <input id="modN" placeholder="Example: 3233" value="3233" />
          </div>
        </div>
        <div class="row">
          <div>
            <label for="privD">Private Key (d)</label>
            <input id="privD" placeholder="Example: 2753" value="2753" />
          </div>
          <div>
            <label for="modN2">Modulus (n)</label>
            <input id="modN2" placeholder="Same n" value="3233" />
          </div>
        </div>
        <label for="message">Message</label>
        <textarea id="message" rows="3" placeholder="Write your message here">
HELLO</textarea
        >
        <button onclick="encrypt()">Encrypt</button>
        <div class="box" id="encrypted"></div>
        <button onclick="decrypt()">Decrypt</button>
        <div class="box" id="decrypted"></div>
        <div class="footer">Educational RSA – Manual Keys Mode</div>
      </div>
    </main>

      <script src="../app/header.js"></script>
      
    <script>
      function isValidNumber(v) {
        return /^[0-9]+$/.test(v);
      }

      function modPow(base, exp, mod) {
        let result = 1n;
        base = base % mod;
        while (exp > 0n) {
          if (exp % 2n === 1n) result = (result * base) % mod;
          base = (base * base) % mod;
          exp = exp / 2n;
        }
        return result;
      }

      function encrypt() {
        let eVal = document.getElementById("pubE").value.trim();
        let nVal = document.getElementById("modN").value.trim();
        let msg = document.getElementById("message").value;

        if (!eVal || !nVal) return alert("Enter public key values");
        if (!isValidNumber(eVal) || !isValidNumber(nVal))
          return alert("Public key must be numbers only");
        if (!msg) return alert("Enter a message");

        let e = BigInt(eVal);
        let n = BigInt(nVal);
        let out = [];

        for (let i = 0; i < msg.length; i++) {
          let charCode = BigInt(msg.charCodeAt(i));
          out.push(modPow(charCode, e, n).toString());
        }

        document.getElementById("encrypted").textContent = out.join(" ");
        document.getElementById("decrypted").textContent = "—";
      }

      function decrypt() {
        let dVal = document.getElementById("privD").value.trim();
        let nVal =
          document.getElementById("modN2").value.trim() ||
          document.getElementById("modN").value.trim();
        if (!dVal || !nVal) return alert("Enter private key values");
        if (!isValidNumber(dVal) || !isValidNumber(nVal))
          return alert("Private key must be numbers only");

        let d = BigInt(dVal);
        let n = BigInt(nVal);
        let data = document
          .getElementById("encrypted")
          .textContent.split(" ")
          .filter((x) => x);
        if (data.length === 0) return alert("No encrypted text to decrypt.");

        let decryptedChars = [];
        for (const cipherText of data) {
          decryptedChars.push(
            String.fromCharCode(Number(modPow(BigInt(cipherText), d, n)))
          );
        }

        document.getElementById("decrypted").textContent =
          decryptedChars.join("");
      }
    </script>
  </body>
</html>
