<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AES Encryption</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="../style/style.css">
<link rel="stylesheet" href="../style/main.css">
  <link rel="stylesheet" href="./assets/style/main.css">
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

</head>
<body>

    <main class="main-content-wrapper">
            <header>
        <div class="header-wrapper">
  <div class="container-default w-container">
    <div class="header-content-wrapper">
      <!-- الجانب الأيسر: اللوجو + الروابط -->
      <div class="header-left-side">
        <a href="https://3mmarx3.github.io/Cryptography/" class="header-logo-link w-nav-brand">
          <img src="https://cdn.prod.website-files.com/64d2cc2d27b51cf1b517c011/6616b1c13ffb5841a23a15ea_logo-cryptoverse-x-webflow-template.png" alt="Logo - Cryptoverse X Webflow Template">
        </a>

        <nav class="header-nav-menu-wrapper">
          <ul class="header-nav-menu-list">
            <li class="header-nav-list-item">
              <a href="https://3mmarx3.github.io/Cryptography/" class="header-nav-link">Home</a>
            </li>
            <li class="header-nav-list-item">
              <a href="https://eng-ammar.com/page/about.php" class="header-nav-link">About</a>
            </li>
            <li class="header-nav-list-item">
              <a href="https://eng-ammar.com/page/project.php" class="header-nav-link">Blog</a>
            </li>
            <li class="header-nav-list-item">
              <a href="https://eng-ammar.com" class="btn-primary small w-button">Get started</a>
            </li>
          </ul>
        </nav>
      </div>

<div class="header-right-side">
  <div class="social-media-links-container">
    <a href="https://www.facebook.com/3mmarx3/" target="_blank" class="social-link-single" aria-label="Facebook">
      <i class="bi bi-facebook" aria-hidden="true"></i>
    </a>

    <a href="https://www.instagram.com/3mmarx3/" target="_blank" class="social-link-single" aria-label="Instagram">
      <i class="bi bi-instagram" aria-hidden="true"></i>
    </a>
    <a href="https://www.linkedin.com/in/eng-ammar-ahmed/" target="_blank" class="social-link-single" aria-label="LinkedIn">
      <i class="bi bi-linkedin" aria-hidden="true"></i>
    </a>
  </div>
</div>

    </div>
  </div>
</div>
  </header>

<div class="card">
  <h1>AES Encryption</h1>
  <div class="subtitle">Enter a secret password</div>
  <label for="password">Password</label>
  <input id="password" placeholder="Enter a secret password">
  <label for="message">Message</label>
  <textarea id="message" rows="3" placeholder="Write your message here"></textarea>
  <button onclick="encryptMessage()">Encrypt</button>
  <div class="box" id="encrypted"></div>
  <button onclick="decryptMessage()">Decrypt</button>
  <div class="box" id="decrypted"></div>
  <div class="footer">Educational AES – Browser Mode</div>
</div>

    </main>

<script>
async function getKey(password, salt){
  let enc = new TextEncoder();
  let keyMaterial = await crypto.subtle.importKey(
    "raw",
    enc.encode(password),
    {name:"PBKDF2"},
    false,
    ["deriveKey"]
  );
  return crypto.subtle.deriveKey(
    {name:"PBKDF2", salt:salt, iterations:100000, hash:"SHA-256"},
    keyMaterial,
    {name:"AES-GCM", length:256},
    true,
    ["encrypt","decrypt"]
  );
}

function buf2hex(buffer){
  return Array.from(new Uint8Array(buffer)).map(b => b.toString(16).padStart(2,'0')).join('');
}

function hex2buf(hex){
  let bytes = new Uint8Array(hex.match(/.{1,2}/g).map(b => parseInt(b,16)));
  return bytes.buffer;
}

async function encryptMessage(){
  let password = document.getElementById("password").value;
  let msg = document.getElementById("message").value;
  if(!password) return alert("Enter password");
  if(!msg) return alert("Enter message");

  let salt = crypto.getRandomValues(new Uint8Array(16));
  let iv = crypto.getRandomValues(new Uint8Array(12));
  let key = await getKey(password, salt);
  let enc = new TextEncoder();
  let encrypted = await crypto.subtle.encrypt({name:"AES-GCM", iv:iv}, key, enc.encode(msg));
  
  let combined = buf2hex(salt) + buf2hex(iv) + buf2hex(encrypted);
  document.getElementById("encrypted").textContent = combined;
  document.getElementById("decrypted").textContent = "—";
}

async function decryptMessage(){
  let password = document.getElementById("password").value;
  let combined = document.getElementById("encrypted").textContent;
  if(!password) return alert("Enter password");
  if(!combined) return alert("No encrypted message");

  let salt = hex2buf(combined.slice(0,32));
  let iv = hex2buf(combined.slice(32,56));
  let data = hex2buf(combined.slice(56));
  let key = await getKey(password, new Uint8Array(salt));
  let decrypted;
  try{
    let dec = await crypto.subtle.decrypt({name:"AES-GCM", iv:new Uint8Array(iv)}, key, data);
    decrypted = new TextDecoder().decode(dec);
  }catch(e){
    return alert("Decryption failed: wrong password or corrupted data");
  }
  document.getElementById("decrypted").textContent = decrypted;
}
</script>
</body>
</html>
